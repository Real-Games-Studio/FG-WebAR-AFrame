<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Web AR com A-Frame e Simple AR</title>
    <!-- Carrega o A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- Carrega a biblioteca Simple AR (ajuste a URL conforme sua instalação) -->
    <script src="https://unpkg.com/simple-ar"></script>
    <style>
      body { margin: 0; padding: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <!-- A cena inclui o componente simple-ar com a detecção de planos ativada -->
    <a-scene simple-ar="planeDetection: true;">
      <!-- Objeto que será posicionado (inicialmente invisível) -->
      <a-box id="myBox" color="#EF2D5E" depth="0.2" height="0.2" width="0.2" visible="false"></a-box>
      
      <!-- Câmera com controles básicos -->
      <a-entity camera position="0 1.6 0" look-controls></a-entity>
    </a-scene>

    <script>
      // Aguarda a cena carregar
      document.querySelector('a-scene').addEventListener('loaded', function () {
        const sceneEl = this;
        // Acessa o canvas da cena
        const canvas = sceneEl.canvas;

        // Função que trata o toque/click na tela
        function handleTap(evt) {
          // Obtém as coordenadas do toque/click
          let clientX, clientY;
          if (evt.touches && evt.touches.length > 0) {
            clientX = evt.touches[0].clientX;
            clientY = evt.touches[0].clientY;
          } else {
            clientX = evt.clientX;
            clientY = evt.clientY;
          }

          // Verifica se o Simple AR e seu método hitTest estão disponíveis
          if (window.SimpleAR && typeof SimpleAR.hitTest === 'function') {
            // Executa o hit test passando as coordenadas de tela
            SimpleAR.hitTest(clientX, clientY)
              .then(function(result) {
                if (result && result.position) {
                  // Seleciona o objeto que queremos posicionar
                  const boxEl = document.getElementById('myBox');
                  // Define a posição obtida pelo hit test
                  boxEl.setAttribute('position', result.position);
                  // Torna o objeto visível
                  boxEl.setAttribute('visible', true);
                } else {
                  console.log('Nenhum plano detectado na posição tocada.');
                }
              })
              .catch(function(err) {
                console.error('Erro no hit test:', err);
              });
          } else {
            console.warn('Simple AR não está disponível ou a função hitTest não foi encontrada.');
          }
        }

        // Adiciona os listeners para toque (em dispositivos móveis) e clique (para testes no desktop)
        canvas.addEventListener('touchend', handleTap, false);
        canvas.addEventListener('click', handleTap, false);
      });
    </script>
  </body>
</html>
